
Nv.add("./js/nv.table",function(nv,$,page,column){var _table=function _table(ev){console.log('set table:',nv);};_table.prototype={_obj:{$wrapId:null,idName:null,params:{},list:[],fields:[],theadDom:null,showNumber:false,showCheckbox:true,operation:[],page:{pageNo:1,total:100,pageSize:10}},checkItemList:[],init:function init(_n){var _this2=this;this._obj.$wrapId=$(_n.id);this._obj.idName=_n.id.replace(/#/,'');Object.assign(this._obj,_n);this._tableDom();this._ajax().then(function(ev){_this2._dataTable();}).catch(function(){console.log('初始化表格数据失败');});},reload:function reload(ev){if(ev===void 0){ev={};}
this._obj.params=ev;this._obj.page.pageNo=1;this._ajax();},_ajax:function _ajax(){var _this3=this;return new Promise(function(resolve,reject){setTimeout(function(){var _mock=[{number:'111',phone:'13920096666',name:'shi',time:'2019',type:'1',other:'asda',appId:'123',address:'afjlsjdlahd',email:'asd@126.com',discr:'asdasdasdas'},{number:'222',phone:'13920096666',name:'zhang',time:'2019',type:'1',other:'asda',appId:'123',address:'afjlsjdlahd',email:'asd@126.com',discr:'asdasdasdas'},{number:'333',phone:'13920096666',name:'wang',time:'2019',type:'1',other:'asda',appId:'123',address:'afjlsjdlahd',email:'asd@126.com',discr:'asdasdasdas'},{number:'444',phone:'13920096666',name:'li',time:'2019',type:'1',other:'asda',appId:'123',address:'afjlsjdlahd',email:'asd@126.com',discr:'asdasdasdas'},{number:'555',phone:'13920096666',name:'zhao',time:'2019',type:'1',other:'asda',appId:'123',address:'afjlsjdlahd',email:'asd@126.com',discr:'asdasdasdas'}];_this3._obj.list=_mock;_this3._setDataDom();_this3._initPage();resolve('resole_');},2000);});},_initPage:function _initPage(){var _this4=this;page.init({id:this._obj.idName+"_page",current:this._obj.page.pageNo,total:this._obj.page.total,pageSize:this._obj.page.pageSize,pageSizeOptions:[10,20,50,100],showPageSize:true,showTotalPage:true,showJump:false,showTotal:true,onChange:function onChange(ev){Object.assign(_this4._obj.page,ev);_this4._ajax();},onShowSizeChange:function onShowSizeChange(ev){_this4._obj.page.pageSize=ev;_this4._ajax();}});},_setDataDom:function _setDataDom(){var _this5=this;var _domList=this._obj.list.map(function(_tr,_ind){return"<tr>\n                        "+(_this5._obj.showCheckbox?"<td>\n                                <input type=\"checkbox\" name=\"tabelCheck\" check-item="+JSON.stringify(_tr)+" class=\"nv-checkbox\">\n                            </td>":"")+"\n                        "+(_this5._obj.showNumber?"<td>"+_ind+"</td>":"")+"\n                        "+_this5._obj.fields.map(function(_th){return"<td>"+(_th.filters&&typeof _th.filters==='function'?_th.filters(_tr,_ind):_tr[_th.key])+"</td>";}).join('')+"\n                        "+(_this5._obj.operation.length>0?"<td>"+_this5._obj.operation.map(function(_event,_indspan){return"<span data-details="+JSON.stringify(_tr)+" data-index=\""+_ind+"\" event-index=\""+_indspan+"\" event-name=\""+_event.eventName+"\" style=\"padding: 0 5px;cursor:pointer;\">"+_event.name+"</span>";}).join('')+"</td>":"")+"\n                    </tr>";}).join('');var _tbody=this._obj.$wrapId.find('tbody');_tbody.empty().append(_domList);},_tableDom:function _tableDom(){this._obj.$wrapId&&this._obj.$wrapId.append("\n                <div class=\"btnBox\" style=\"padding:10px;text-align: right;\">\n                    <div class=\"nv-dropdown nv-dropdown-btn nv-dropdown-right\" data-type=\"click\">\n                        <a class=\"nv-dropdown-link\" href=\"javascript:;\">\u8BBE\u7F6E\u5217\n                            <!---->\n                            <i class=\"nv-icon-angle nv-icon-down\"></i>\n                        </a>\n                        <ul class=\"nv-dropdown-menu rowSelect\" style=\"width: max-content;\">\n                            "+this._obj.fields.map(function(_th,_index){return"<li check-index=\""+_index+"\" style=\"padding:5px 20px;\"  class=\"nv-dropdown-item\">\n                                        <input type=\"checkbox\" checked=\"checked\" class=\"nv-checkbox\">\n                                        "+_th.name+"\n                                    </li>";}).join('')+"\n                        </ul>\n                    </div>\n                </div>\n                <div class=\"nv-table-wrap nv-table-wrap-border\" style=\"padding: 10px;\">\n                    <table class=\"table\">\n                        <thead>\n                            <tr>\n                                "+(this._obj.showCheckbox?"<th style=\"text-align: center;\">\n                                        <input type=\"checkbox\" name=\"tabelCheck\" data-all=\"true\" class=\"nv-checkbox\">\n                                    </th>":"")+"\n                                "+(this._obj.showNumber?"<th style=\"text-align: center;\">\u5E8F\u53F7</th>":"")+"\n                                "+this._obj.fields.map(function(_th,_ind){return"<th style=\"text-align: center;\" th-index=\""+_ind+"\">"+_th.name+"</th>";}).join('')+"\n                                "+(this._obj.operation.length>0?"<th style=\"text-align: center;\">\u64CD\u4F5C</th>":"")+"\n                            </tr>\n                        </thead>\n                        <tbody>\n                                <!-- \u6B64\u5185\u5BB9\u533A\u5728 _setDataDom \u65B9\u6CD5\u4E2D\u91CD\u7ED8 -->\n                        </tbody>\n                    </table>\n                    \n                </div>\n                <div class=\"nv-pagination\" style=\"padding: 10px;text-align:right;\" id=\""+this._obj.idName+"_page\"></div>\n            \n            ");},_dataTable:function _dataTable(){var _this=this;var __obj=_this._obj;var _wrapId=__obj.$wrapId;var table=_wrapId.find('.table').DataTable({paging:false,bLengthChange:false,autoWidth:true,columnDefs:[{targets:[0,2,3],orderable:false,render:function render(h){return'';}}]});_wrapId.find('.rowSelect').on('click','li .nv-checkbox',function(ev){var _target=$(ev.target),_ind=_target.parent().attr('check-index');var _thInd=__obj.theadDom.find("th[th-index="+_ind+"]").index();var column=table.column(_thInd);column.visible(!column.visible());});_wrapId.find('tbody').on('click','tr [event-name]',function(ev){var _target=$(ev.target);var dataDetails=_target.attr('data-details'),eventName=_target.attr('event-name'),eventINdex=_target.attr('event-index'),dataIndex=_target.attr('data-index');var _items={item:JSON.parse(dataDetails),eventName:eventName,eventINdex:eventINdex,dataIndex:dataIndex};typeof _this.onOperation==='function'&&_this.onOperation(_items,_target);});var _checkItem=_wrapId.find('tbody tr [check-item]');_wrapId.find('thead').on('click','tr [data-all]',function(ev){var _isCheckedAll=$(ev.target).is(':checked');_this.checkItemList.length=0;if(_isCheckedAll){_checkItem.each(function(index,dom){var _dom=$(dom),_item=_dom.attr('check-item');_this.checkItemList.push(JSON.parse(_item));});}
console.log('__obj.checkItemList:',_this.checkItemList);});_checkItem.on('click',function(ev){_this.checkItemList.length=0;_checkItem.each(function(index,dom){var _dom=$(dom),_item=_dom.attr('check-item'),_isChecked=_dom.is(':checked');_isChecked&&_this.checkItemList.push(JSON.parse(_item));});console.log('__obj.checkItemList:',_this.checkItemList);});__obj.theadDom=__obj.$wrapId.find('thead').clone();}};Nv.table=new _table();return Nv.table||{};},{requires:["jquery","page","fixedColumns"],alias:'table'});